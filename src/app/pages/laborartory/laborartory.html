<div class="p-8 space-y-6 bg-slate-50 dark:bg-slate-950 min-h-screen transition-colors">
  <div
    class="flex flex-wrap justify-between items-center bg-white dark:bg-slate-900 p-8 rounded-[40px] border border-slate-200 dark:border-slate-800 shadow-sm transition-all"
  >
    <div>
      <h1 class="text-3xl font-black text-slate-800 dark:text-white tracking-tighter italic">
        Laboratory Command Center
      </h1>
      <p class="text-sm text-slate-500 dark:text-slate-400 font-medium mt-1">
        Monitoring real-time diagnostic requests
      </p>
    </div>

    <div class="flex items-center gap-4">
      <div
        class="bg-amber-50 dark:bg-amber-900/20 text-amber-600 dark:text-amber-400 px-5 py-3 rounded-2xl text-[10px] font-black tracking-[0.2em] flex items-center gap-3 border border-amber-100 dark:border-amber-900/30"
      >
        @if (statCount() > 0) {
          <span class="relative flex h-3 w-3">
            <span
              class="animate-ping absolute inline-flex h-full w-full rounded-full bg-amber-400 opacity-75"
            ></span>
            <span class="relative inline-flex rounded-full h-3 w-3 bg-amber-500"></span>
          </span>
        }
        {{ statCount() }} STAT ORDERS PENDING
      </div>
    </div>
  </div>

  <div class="flex gap-4">
    <div class="relative flex-1 group">
      <span
        class="absolute left-5 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-blue-500 transition-colors"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path
            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
            stroke-width="3"
            stroke-linecap="round"
          />
        </svg>
      </span>
      <input
        type="text"
        [ngModel]="searchQuery()"
        (ngModelChange)="searchQuery.set($event)"
        placeholder="Search Sample ID, Patient UHID or Name..."
        class="w-full pl-14 pr-6 py-4 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-[24px] outline-none focus:ring-4 focus:ring-blue-500/10 dark:text-white font-bold transition-all"
      />
    </div>
  </div>

  <div
    class="bg-white dark:bg-slate-900 rounded-[40px] border border-slate-200 dark:border-slate-800 overflow-hidden shadow-sm"
  >
    <table class="w-full text-left border-collapse">
      <thead
        class="bg-slate-50 dark:bg-slate-800/50 border-b border-slate-100 dark:border-slate-800"
      >
        <tr>
          <th class="p-6 text-[10px] font-black text-slate-400 uppercase tracking-widest">
            Sample ID
          </th>
          <th class="p-6 text-[10px] font-black text-slate-400 uppercase tracking-widest">
            Patient / UHID
          </th>
          <th class="p-6 text-[10px] font-black text-slate-400 uppercase tracking-widest">
            Test Profile
          </th>
          <th
            class="p-6 text-[10px] font-black text-slate-400 uppercase tracking-widest text-center"
          >
            Priority
          </th>
          <th class="p-6 text-[10px] font-black text-slate-400 uppercase tracking-widest">
            Status
          </th>
          <th
            class="p-6 text-[10px] font-black text-slate-400 uppercase tracking-widest text-right"
          >
            Action
          </th>
        </tr>
      </thead>
      <tbody class="divide-y divide-slate-50 dark:divide-slate-800">
        @for (item of filteredQueue(); track item.id) {
          <tr class="hover:bg-blue-50/30 dark:hover:bg-blue-900/10 transition-colors group">
            <td class="p-6">
              <span
                class="font-mono font-black text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/30 px-3 py-1.5 rounded-xl text-xs border border-blue-100 dark:border-blue-900/40"
              >
                #{{ item.sampleId }}
              </span>
            </td>
            <td class="p-6">
              <div class="font-black text-slate-800 dark:text-slate-100">
                {{ item.patientName }}
              </div>
              <div
                class="text-[10px] text-slate-400 dark:text-slate-500 font-black tracking-widest"
              >
                UHID: {{ item.uhid }}
              </div>
            </td>
            <td class="p-6">
              <div class="flex flex-wrap gap-1.5">
                @for (test of item.tests; track test) {
                  <span
                    class="bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 px-3 py-1 rounded-lg text-[10px] font-black border border-slate-200 dark:border-slate-700"
                  >
                    {{ test }}
                  </span>
                }
              </div>
            </td>
            <td class="p-6 text-center">
              <span
                [class]="
                  item.priority === 'STAT'
                    ? 'bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 animate-pulse border-red-100 dark:border-red-900/30'
                    : 'bg-slate-100 dark:bg-slate-800 text-slate-500 dark:text-slate-400 border-slate-200 dark:border-slate-700'
                "
                class="px-4 py-1.5 rounded-full text-[10px] font-black uppercase tracking-widest border"
              >
                {{ item.priority }}
              </span>
            </td>
            <td class="p-6">
              <span
                class="flex items-center gap-2 text-[11px] font-black text-amber-600 dark:text-amber-400 uppercase tracking-tighter"
              >
                <span
                  class="w-2 h-2 rounded-full bg-amber-500 shadow-[0_0_8px_rgba(245,158,11,0.5)]"
                ></span>
                {{ item.status }}
              </span>
            </td>
            <td class="p-6 text-right">
              <button
                (click)="openResultEntry(item)"
                class="bg-slate-900 dark:bg-blue-600 text-white px-6 py-3 rounded-[18px] text-[10px] font-black uppercase tracking-widest hover:bg-blue-600 dark:hover:bg-blue-700 transition-all shadow-lg shadow-slate-200 dark:shadow-none"
              >
                Enter Results
              </button>
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>

  @if (showResultEntry()) {
    <div class="fixed inset-0 z-[150] flex justify-end">
      <div
        class="absolute inset-0 bg-slate-900/70 dark:bg-black/85 backdrop-blur-md"
        (click)="showResultEntry.set(false)"
      ></div>

      <div
        class="relative w-full max-w-2xl bg-white dark:bg-slate-900 h-full shadow-2xl flex flex-col animate-in slide-in-from-right duration-500 border-l dark:border-slate-800"
      >
        <div class="p-10 bg-slate-900 dark:bg-slate-950 text-white relative overflow-hidden">
          <div class="relative z-10">
            <h2 class="text-3xl font-black italic tracking-tighter">Result Validation</h2>
            <div class="flex items-center gap-4 mt-2">
              <span class="text-xs text-blue-400 font-black uppercase tracking-[0.2em]"
                >Sample: #{{ selectedOrder()?.sampleId }}</span
              >
              <span class="w-1 h-1 bg-slate-700 rounded-full"></span>
              <span class="text-xs text-slate-400 font-black uppercase tracking-[0.2em]">{{
                selectedOrder()?.patientName
              }}</span>
            </div>
          </div>
          <div
            class="absolute top-0 right-0 p-12 text-slate-800 opacity-20 text-8xl font-black italic"
          >
            LAB
          </div>
        </div>

        <form #rf="ngForm" class="flex-1 overflow-y-auto p-10 space-y-8 bg-white dark:bg-slate-900">
          @for (param of dynamicParameters(); track param.parameter_id) {
            <div
              class="group p-6 bg-slate-50 dark:bg-slate-800/50 rounded-[30px] flex items-center justify-between border border-slate-100 dark:border-slate-800 hover:border-blue-200 transition-all"
            >
              <div>
                <p
                  class="text-xs font-black text-slate-800 dark:text-slate-100 uppercase tracking-widest"
                >
                  {{ param.parameter_name }}
                </p>
                <p class="text-[10px] text-slate-400 dark:text-slate-500 font-bold mt-1">
                  Ref Range: {{ param.normal_range }} {{ param.unit }}
                </p>
                <p class="text-[8px] text-blue-500 font-black uppercase">{{ param.test_name }}</p>
              </div>

              <div class="flex items-center gap-3">
                <input
                  type="text"
                  [name]="param.parameter_id.toString()"
                  ngModel
                  placeholder="--"
                  class="w-28 px-4 py-3 rounded-2xl border-2 border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 text-center font-black text-lg outline-none focus:border-blue-500 transition-all dark:text-white"
                />
                <span class="text-[10px] font-black text-slate-400 uppercase">{{
                  param.unit
                }}</span>
              </div>
            </div>
          }
        </form>
        <div
          class="p-10 border-t border-slate-100 dark:border-slate-800 bg-slate-50 dark:bg-slate-950 flex gap-4"
        >
          <button
            type="button"
            (click)="saveDraft(rf.value)"
            class="flex-1 py-5 bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-300 rounded-[24px] font-black uppercase text-xs tracking-widest border border-slate-200 dark:border-slate-700 hover:bg-slate-100 transition-all"
          >
            Save Draft
          </button>
          <button
            class="flex-[2] py-5 bg-emerald-600 text-white rounded-[24px] font-black uppercase text-xs tracking-[0.2em] shadow-2xl shadow-emerald-200 dark:shadow-none hover:bg-emerald-700 transition-all"
            (click)="authorizeResults(rf.value)"
          >
            Authorize & Release
          </button>
        </div>
      </div>
    </div>
  }
</div>
